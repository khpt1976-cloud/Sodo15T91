<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S∆° ƒë·ªì Ki·∫øn tr√∫c Microservice</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a2332 0%, #2c3e50 100%);
            min-height: 100vh;
            overflow: hidden;
        }
        .container {
            background: rgba(26, 35, 50, 0.9);
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        h1 {
            text-align: center;
            color: white;
            margin: 0;
            padding: 15px 0;
            background: rgba(26, 35, 50, 0.95);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1000;
        }
        
        /* Toolbar c√¥ng c·ª• */
        .toolbar {
            position: fixed;
            top: 70px;
            right: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            padding: 10px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .tool-btn {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 8px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tool-btn:hover {
            background: #0056b3;
            transform: scale(1.05);
        }
        
        .tool-btn:active {
            transform: scale(0.95);
        }
        
        .tool-btn.reset {
            background: #28a745;
        }
        
        .tool-btn.reset:hover {
            background: #1e7e34;
        }
        
        /* Tooltip */
        .tool-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            right: 55px;
            top: 50%;
            transform: translateY(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .tool-btn:hover::after {
            opacity: 1;
        }
        
        /* Container cho diagram c√≥ th·ªÉ zoom v√† pan */
        .diagram-container {
            position: absolute;
            top: 70px;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            cursor: grab;
        }
        
        .diagram-container.panning {
            cursor: grabbing;
        }
        
        .mermaid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
            transition: transform 0.3s ease;
        }
        
        /* CSS ƒë·ªÉ cƒÉn gi·ªØa Frontend Applications v√† API Gateway */
        .mermaid svg {
            overflow: visible;
            width: 100%;
            height: auto;
            min-height: 100%;
        }
        
        /* Zoom level indicator */
        .zoom-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1001;
        }

        /* T√πy ch·ªânh m√†u n·ªÅn cho c√°c subgraph ch√≠nh */
        .mermaid .cluster rect {
            opacity: 0.4 !important;
        }
        
        /* Force m√†u cho c√°c subgraph b·∫±ng CSS */
        .mermaid svg g.cluster:nth-child(1) rect {
            fill: #E3F2FD !important;
        }
        .mermaid svg g.cluster:nth-child(2) rect {
            fill: #E8F5E8 !important;
        }
        .mermaid svg g.cluster:nth-child(3) rect {
            fill: #F3E5F5 !important;
        }
        .mermaid svg g.cluster:nth-child(4) rect {
            fill: #FFF3E0 !important;
        }
        
        /* ·∫®n ho√†n to√†n c√°c spacer nodes */
        .mermaid g[id*="SPACER"] {
            display: none !important;
        }
        
        /* Navigation Bar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #1a2332;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            display: flex;
            align-items: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-decoration: none;
            flex: 1;
        }
        
        .navbar-brand .logo {
            width: 32px;
            height: 32px;
            background: #00bcd4;
            border-radius: 6px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .navbar-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 30px;
            flex: 2;
            justify-content: center;
        }
        
        .navbar-menu li a {
            color: white;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }
        
        .navbar-menu li a:hover {
            color: #00bcd4;
        }
        
        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn-login {
            background: #00bcd4;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn-login:hover {
            background: #00acc1;
        }
        
        /* ƒêi·ªÅu ch·ªânh body ƒë·ªÉ kh√¥ng b·ªã che b·ªüi navbar */
        body {
            padding-top: 60px;
        }
        
        
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .component-card {
            background: rgba(44, 62, 80, 0.6);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #00bcd4;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .component-card h4 {
            color: #00bcd4;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .component-card p {
            font-size: 0.9em;
            color: #d0d0d0;
            margin: 0;
        }
        
        .back-btn {
            background: #00bcd4;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            transition: background 0.3s;
            position: fixed;
            top: 70px;
            left: 20px;
            z-index: 1000;
        }
        
        .back-btn:hover {
            background: #00acc1;
        }




    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="#" class="navbar-brand">
            <div class="logo">MS</div>
            Microservice Architecture
        </a>
        
        <ul class="navbar-menu">
            <li><a href="#" onclick="showDiagram()">Trang ch·ªß</a></li>
            <li><a href="#" onclick="showDiagram()">S∆° ƒë·ªì</a></li>
            <li><a href="#">API</a></li>
            <li><a href="#">Li√™n h·ªá</a></li>
        </ul>
        
        <div style="flex: 1;"></div>

    </nav>


    <div class="container" id="diagramContainer">
        <h1>S∆° ƒë·ªì Ki·∫øn tr√∫c Microservice</h1>
        
        <!-- Toolbar c√¥ng c·ª• -->
        <div class="toolbar">
            <button class="tool-btn" data-tooltip="Ph√≥ng to" onclick="zoomIn()">üîç+</button>
            <button class="tool-btn" data-tooltip="Thu nh·ªè" onclick="zoomOut()">üîç-</button>
            <button class="tool-btn reset" data-tooltip="ƒê·∫∑t l·∫°i" onclick="resetView()">üè†</button>
            <button class="tool-btn" data-tooltip="Fit m√†n h√¨nh" onclick="fitToScreen()">üìê</button>
        </div>
        
        <!-- Zoom indicator -->
        <div class="zoom-indicator" id="zoomIndicator">100%</div>
        
        <!-- Container cho diagram -->
        <div class="diagram-container" id="diagramContainer">
            <div class="mermaid" id="mermaidDiagram">
graph TB
    subgraph "Frontend Applications"
        direction TB
        ShellAppUser[Shell App User]
        ShellAppAdmin[Shell App Admin]
        
        subgraph "User Frontend Components"
            direction TB
            CartFE[Cart Service Frontend<br>Giao di·ªán Gi·ªè h√†ng]:::frontend
            ProductFE[Product Service Frontend<br>Giao di·ªán S·∫£n ph·∫©m]:::frontend
            NewsFE[News Service Frontend<br>Giao di·ªán Tin t·ª©c]:::frontend
            DesignCalculationFE[Design Calculation Frontend<br>Giao di·ªán T√≠nh to√°n Thi·∫øt k·∫ø]:::frontend
            FootballFE[Football Service Frontend<br>Giao di·ªán B√≥ng ƒë√°]:::frontend
            CommunicationLogFE[Communication Log Frontend<br>Giao di·ªán Nh·∫≠t k√Ω thi c√¥ng]:::frontend
            ChatbotFE[Chatbot Service Frontend<br>Giao di·ªán Chatbot]:::frontend
            PaymentFE[Payment Service Frontend<br>Giao di·ªán Thanh to√°n]:::frontend
            UserFE[User Service Frontend<br>Giao di·ªán Ng∆∞·ªùi d√πng]:::frontend
            AdminFE[Admin Service Frontend<br>Giao di·ªán Qu·∫£n tr·ªã]:::frontend
            AgentManagementFE[Agent Management Frontend<br>Giao di·ªán Qu·∫£n l√Ω ƒê·∫°i l√Ω]:::frontend
            AgentPolicyFE[Agent Policy Frontend<br>Giao di·ªán Ch√≠nh s√°ch ƒê·∫°i l√Ω]:::frontend
        end
        
        subgraph "Admin Frontend Components"
            direction TB
            CartAdminFE[Cart Service Admin<br>Qu·∫£n tr·ªã Gi·ªè h√†ng]:::adminfe
            ProductAdminFE[Product Service Admin<br>Qu·∫£n tr·ªã S·∫£n ph·∫©m]:::adminfe
            NewsAdminFE[News Service Admin<br>Qu·∫£n tr·ªã Tin t·ª©c]:::adminfe
            DesignCalculationAdminFE[Design Calculation Admin<br>Qu·∫£n tr·ªã T√≠nh to√°n Thi·∫øt k·∫ø]:::adminfe
            FootballAdminFE[Football Service Admin<br>Qu·∫£n tr·ªã B√≥ng ƒë√°]:::adminfe
            CommunicationLogAdminFE[Communication Log Admin<br>Qu·∫£n tr·ªã Nh·∫≠t k√Ω thi c√¥ng]:::adminfe
            ChatbotAdminFE[Chatbot Service Admin<br>Qu·∫£n tr·ªã Chatbot]:::adminfe
            PaymentAdminFE[Payment Service Admin<br>Qu·∫£n tr·ªã Thanh to√°n]:::adminfe
            UserAdminFE[User Service Admin<br>Qu·∫£n tr·ªã Ng∆∞·ªùi d√πng]:::adminfe
            AdminAdminFE[Admin Service Admin<br>Qu·∫£n tr·ªã H·ªá th·ªëng]:::adminfe
            AgentManagementAdminFE[Agent Management Admin<br>Qu·∫£n tr·ªã ƒê·∫°i l√Ω]:::adminfe
            AgentPolicyAdminFE[Agent Policy Admin<br>Qu·∫£n tr·ªã Ch√≠nh s√°ch ƒê·∫°i l√Ω]:::adminfe
            ShellConfigAdminFE[Shell Config Admin<br>Qu·∫£n tr·ªã C·∫•u h√¨nh Shell]:::adminfe
        end
    end

    %% T·∫°o kho·∫£ng c√°ch ƒë·ªÉ ƒë·∫©y h√†ng tr√™n l√™n cao
    SPACER1[ ]:::invisible
    SPACER2[ ]:::invisible
    SPACER3[ ]:::invisible
    SPACER4[ ]:::invisible
    SPACER5[ ]:::invisible
    SPACER6[ ]:::invisible
    SPACER7[ ]:::invisible
    SPACER8[ ]:::invisible

    subgraph "API Gateway (C·ªïng API)"
        direction TB
        APIGatewayUser[API Gateway User]
        APIGatewayAdmin[API Gateway Admin]
    end

    subgraph "Backend Microservices (C√°c d·ªãch v·ª• ƒë·ªôc l·∫≠p)"
            CartService(Cart Service<br>D·ªãch v·ª• Gi·ªè h√†ng):::group1
        ProductService(Product Service<br>D·ªãch v·ª• S·∫£n ph·∫©m):::group1
        NewsService(News Service<br>D·ªãch v·ª• Tin t·ª©c):::group1
        
            DesignCalculationService(Design Calculation Service<br>D·ªãch v·ª• T√≠nh to√°n Thi·∫øt k·∫ø):::group2
        FootballService(Football Service<br>D·ªãch v·ª• B√≥ng ƒë√°):::group2
        CommunicationLogService(Communication Log Service<br>D·ªãch v·ª• Nh·∫≠t k√Ω thi c√¥ng):::group2
        ChatbotService(Chatbot Service<br>D·ªãch v·ª• Chatbot):::group2
        
            PaymentService(Payment Service<br>D·ªãch v·ª• Thanh to√°n):::group3
        UserService(User Service<br>D·ªãch v·ª• Ng∆∞·ªùi d√πng):::group3
        ShellConfigService(Shell Config Service<br>D·ªãch v·ª• C·∫•u h√¨nh Shell):::group3
        AdminService(Admin Service<br>D·ªãch v·ª• Qu·∫£n tr·ªã):::group3
        
            AgentManagementService(Agent Management Service<br>D·ªãch v·ª• Qu·∫£n l√Ω ƒê·∫°i l√Ω):::group4
        AgentPolicyService(Agent Policy Service<br>D·ªãch v·ª• Ch√≠nh s√°ch ƒê·∫°i l√Ω):::group4
    end

    subgraph "Infrastructure (H·∫° t·∫ßng)"
        direction TB
        MessageBroker(Message Broker)
        Cache(Cache)
        
        subgraph "Databases"
            direction TB
            CartDB[Cart DB]:::newdb
            ProductDB[Product DB]:::newdb
            NewsDB[News DB]:::newdb
            DesignCalculationDB[Design Calculation DB]
            FootballDB[Football DB]:::newdb
            CommunicationLogDB[Communication Log DB]:::newdb
            ChatbotDB[Chatbot DB]
            PaymentDB[Payment DB]
            UserDB[User DB]
            ShellConfigDB[Shell Config DB]:::newdb
            AdminDB[Admin DB]
            AgentManagementDB[Agent Management DB]
            AgentPolicyDB[Agent Policy DB]
        end
    end

    ShellAppUser --> APIGatewayUser
    ShellAppAdmin --> APIGatewayAdmin
    
    %% Shell App User loads c√°c frontend components
    ShellAppUser --> CartFE
    ShellAppUser --> ProductFE
    ShellAppUser --> NewsFE
    ShellAppUser --> DesignCalculationFE
    ShellAppUser --> FootballFE
    ShellAppUser --> CommunicationLogFE
    ShellAppUser --> ChatbotFE
    ShellAppUser --> PaymentFE
    ShellAppUser --> UserFE
    ShellAppUser --> AdminFE
    ShellAppUser --> AgentManagementFE
    ShellAppUser --> AgentPolicyFE

    %% Shell App Admin loads c√°c admin frontend components
    ShellAppAdmin --> CartAdminFE
    ShellAppAdmin --> ProductAdminFE
    ShellAppAdmin --> NewsAdminFE
    ShellAppAdmin --> DesignCalculationAdminFE
    ShellAppAdmin --> FootballAdminFE
    ShellAppAdmin --> CommunicationLogAdminFE
    ShellAppAdmin --> ChatbotAdminFE
    ShellAppAdmin --> PaymentAdminFE
    ShellAppAdmin --> UserAdminFE
    ShellAppAdmin --> AdminAdminFE
    ShellAppAdmin --> AgentManagementAdminFE
    ShellAppAdmin --> AgentPolicyAdminFE
    ShellAppAdmin --> ShellConfigAdminFE

    %% Frontend components k·∫øt n·ªëi v·ªõi backend services th√¥ng qua API Gateway
    CartFE --> APIGatewayUser
    ProductFE --> APIGatewayUser
    NewsFE --> APIGatewayUser
    DesignCalculationFE --> APIGatewayUser
    FootballFE --> APIGatewayUser
    CommunicationLogFE --> APIGatewayUser
    ChatbotFE --> APIGatewayUser
    PaymentFE --> APIGatewayUser
    UserFE --> APIGatewayUser
    AdminFE --> APIGatewayUser
    AgentManagementFE --> APIGatewayUser
    AgentPolicyFE --> APIGatewayUser

    %% Admin Frontend components k·∫øt n·ªëi v·ªõi backend services th√¥ng qua API Gateway Admin
    CartAdminFE --> APIGatewayAdmin
    ProductAdminFE --> APIGatewayAdmin
    NewsAdminFE --> APIGatewayAdmin
    DesignCalculationAdminFE --> APIGatewayAdmin
    FootballAdminFE --> APIGatewayAdmin
    CommunicationLogAdminFE --> APIGatewayAdmin
    ChatbotAdminFE --> APIGatewayAdmin
    PaymentAdminFE --> APIGatewayAdmin
    UserAdminFE --> APIGatewayAdmin
    AdminAdminFE --> APIGatewayAdmin
    AgentManagementAdminFE --> APIGatewayAdmin
    AgentPolicyAdminFE --> APIGatewayAdmin
    ShellConfigAdminFE --> APIGatewayAdmin

    APIGatewayUser --> CartService
    APIGatewayUser --> ProductService
    APIGatewayUser --> NewsService
    APIGatewayUser --> FootballService
    APIGatewayUser --> ChatbotService
    APIGatewayUser --> PaymentService
    APIGatewayUser --> UserService
    
    APIGatewayAdmin --> CartService
    APIGatewayAdmin --> ProductService
    APIGatewayAdmin --> NewsService
    APIGatewayAdmin --> DesignCalculationService
    APIGatewayAdmin --> FootballService
    APIGatewayAdmin --> CommunicationLogService
    APIGatewayAdmin --> ChatbotService
    APIGatewayAdmin --> PaymentService
    APIGatewayAdmin --> UserService
    APIGatewayAdmin --> ShellConfigService
    APIGatewayAdmin --> AdminService
    APIGatewayAdmin --> AgentManagementService
    APIGatewayAdmin --> AgentPolicyService

    AdminService --> UserService
    AdminService --> PaymentService
    AdminService --> AgentPolicyService
    AdminService --> AgentManagementService
    AdminService --> ProductService
    AdminService --> CartService
    AdminService --> NewsService
    AgentPolicyService --> PaymentService
    CartService --> ProductService
    CartService --> UserService
    CartService --> PaymentService
    FootballService --> UserService
    CommunicationLogService --> AdminService
    ShellConfigService --> AdminService

    PaymentService --> MessageBroker
    UserService --> MessageBroker
    AgentPolicyService --> Cache
    CartService --> MessageBroker
    ProductService --> Cache
    NewsService --> Cache
    FootballService --> Cache
    ShellConfigService --> Cache

    CartService --> CartDB
    ProductService --> ProductDB
    NewsService --> NewsDB
    DesignCalculationService --> DesignCalculationDB
    FootballService --> FootballDB
    CommunicationLogService --> CommunicationLogDB
    ChatbotService --> ChatbotDB
    PaymentService --> PaymentDB
    UserService --> UserDB
    ShellConfigService --> ShellConfigDB
    AdminService --> AdminDB
    AgentManagementService --> AgentManagementDB
    AgentPolicyService --> AgentPolicyDB

    %% Infrastructure Layer - N·ªÅn t·∫£ng h·∫° t·∫ßng ƒë·ªôc l·∫≠p
    subgraph "üèóÔ∏è Infrastructure Layer"
        direction TB
        InfrastructureBase[Infrastructure<br/>N·ªÅn t·∫£ng h·∫° t·∫ßng<br/>Docker, Kubernetes, Cloud Services<br/>Monitoring, Logging, Security]:::infrastructure
    end

    classDef group1 fill:#E6F3FF,stroke:#333,stroke-width:2px
    classDef group2 fill:#F0FFF0,stroke:#333,stroke-width:2px
    classDef group3 fill:#FFF0F5,stroke:#333,stroke-width:2px
    classDef group4 fill:#F5F5DC,stroke:#333,stroke-width:2px
    classDef newdb fill:#FFE4B5,stroke:#333,stroke-width:2px
    classDef frontend fill:#E6E6FA,stroke:#4B0082,stroke-width:2px
    classDef adminfe fill:#FFE4E1,stroke:#DC143C,stroke-width:2px
    classDef infrastructure fill:#F5F5F5,stroke:#2C3E50,stroke-width:3px
    
    %% ƒê·ªãnh nghƒ©a m√†u n·ªÅn cho subgraph
    classDef subgraph1 fill:#E3F2FD,stroke:#333,stroke-width:2px
    classDef subgraph2 fill:#E8F5E8,stroke:#333,stroke-width:2px  
    classDef subgraph3 fill:#F3E5F5,stroke:#333,stroke-width:2px
    classDef subgraph4 fill:#FFF3E0,stroke:#333,stroke-width:2px
    
    %% ·∫®n c√°c spacer nodes
    classDef invisible fill:transparent,stroke:transparent,color:transparent
            </div>
        </div>
        


    </div>

    <script>
        // Bi·∫øn to√†n c·ª•c cho zoom v√† pan
        let currentZoom = 1;
        let currentX = 0;
        let currentY = 0;
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        
        // Kh·ªüi t·∫°o Mermaid v·ªõi custom theme
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                clusterBkg: '#E3F2FD',
                clusterBorder: '#333'
            },
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true
            }
        });
        
        // H√†m c·∫≠p nh·∫≠t transform
        function updateTransform() {
            const mermaidElement = document.getElementById('mermaidDiagram');
            mermaidElement.style.transform = `translate(${currentX}px, ${currentY}px) scale(${currentZoom})`;
            document.getElementById('zoomIndicator').textContent = Math.round(currentZoom * 100) + '%';
        }
        
        // H√†m zoom in
        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 3);
            updateTransform();
        }
        
        // H√†m zoom out
        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.1);
            updateTransform();
        }
        
        // H√†m reset view
        function resetView() {
            currentZoom = 1;
            currentX = 0;
            currentY = 0;
            updateTransform();
        }
        
        // H√†m fit to screen
        function fitToScreen() {
            const container = document.getElementById('diagramContainer');
            const mermaidElement = document.getElementById('mermaidDiagram');
            const svg = mermaidElement.querySelector('svg');
            
            if (svg) {
                const containerRect = container.getBoundingClientRect();
                const svgRect = svg.getBoundingClientRect();
                
                const scaleX = containerRect.width / svgRect.width;
                const scaleY = containerRect.height / svgRect.height;
                currentZoom = Math.min(scaleX, scaleY) * 0.9;
                
                currentX = (containerRect.width - svgRect.width * currentZoom) / 2;
                currentY = (containerRect.height - svgRect.height * currentZoom) / 2;
                
                updateTransform();
            }
        }
        
        // X·ª≠ l√Ω s·ª± ki·ªán chu·ªôt cho pan
        document.getElementById('diagramContainer').addEventListener('mousedown', function(e) {
            if (e.button === 0) { // Left mouse button
                isDragging = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                this.classList.add('panning');
                e.preventDefault();
            }
        });
        
        document.addEventListener('mousemove', function(e) {
            if (isDragging) {
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                
                currentX += deltaX;
                currentY += deltaY;
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                
                updateTransform();
            }
        });
        
        document.addEventListener('mouseup', function(e) {
            if (isDragging) {
                isDragging = false;
                document.getElementById('diagramContainer').classList.remove('panning');
            }
        });
        
        // X·ª≠ l√Ω zoom b·∫±ng scroll wheel
        document.getElementById('diagramContainer').addEventListener('wheel', function(e) {
            e.preventDefault();
            
            const rect = this.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const oldZoom = currentZoom;
            
            if (e.deltaY < 0) {
                currentZoom = Math.min(currentZoom * 1.1, 3);
            } else {
                currentZoom = Math.max(currentZoom / 1.1, 0.1);
            }
            
            // Zoom v·ªÅ ph√≠a con tr·ªè chu·ªôt
            const zoomRatio = currentZoom / oldZoom;
            currentX = mouseX - (mouseX - currentX) * zoomRatio;
            currentY = mouseY - (mouseY - currentY) * zoomRatio;
            
            updateTransform();
        });
        
        // X·ª≠ l√Ω ph√≠m t·∫Øt
        document.addEventListener('keydown', function(e) {
            switch(e.key) {
                case '+':
                case '=':
                    zoomIn();
                    e.preventDefault();
                    break;
                case '-':
                    zoomOut();
                    e.preventDefault();
                    break;
                case '0':
                    resetView();
                    e.preventDefault();
                    break;
                case 'f':
                case 'F':
                    fitToScreen();
                    e.preventDefault();
                    break;
            }
        });
        
        // H√†m thay ƒë·ªïi m√†u n·ªÅn subgraph
        function changeSubgraphColors() {
            const svg = document.querySelector('#mermaidDiagram svg');
            if (!svg) return;
            
            // T√¨m t·∫•t c·∫£ c√°c cluster (subgraph backgrounds) - th·ª≠ nhi·ªÅu c√°ch
            let clusters = svg.querySelectorAll('.cluster rect');
            if (clusters.length === 0) {
                clusters = svg.querySelectorAll('g.cluster rect');
            }
            if (clusters.length === 0) {
                clusters = svg.querySelectorAll('rect[fill="#FFFFDE"]');
            }
            if (clusters.length === 0) {
                clusters = svg.querySelectorAll('rect');
            }
            
            console.log('Found', clusters.length, 'cluster elements');
            
            // ƒê·ªãnh nghƒ©a 4 m√†u nh·∫°t kh√°c nhau
            const colors = [
                '#E3F2FD', // Xanh lam nh·∫°t - Frontend Applications
                '#E8F5E8', // Xanh l√° nh·∫°t - API Gateway  
                '#F3E5F5', // T√≠m nh·∫°t - Backend Microservices
                '#FFF3E0'  // Cam nh·∫°t - Infrastructure
            ];
            
            // L·ªçc ch·ªâ l·∫•y c√°c rect l·ªõn (subgraph backgrounds)
            const largeClusters = Array.from(clusters).filter(rect => {
                const width = parseFloat(rect.getAttribute('width') || 0);
                const height = parseFloat(rect.getAttribute('height') || 0);
                return width > 200 && height > 100; // Ch·ªâ l·∫•y c√°c rect l·ªõn
            });
            
            console.log('Found', largeClusters.length, 'large cluster backgrounds');
            
            // √Åp d·ª•ng m√†u cho t·ª´ng cluster l·ªõn
            largeClusters.forEach((rect, index) => {
                if (index < colors.length) {
                    rect.setAttribute('fill', colors[index]);
                    rect.setAttribute('opacity', '0.4');
                    console.log(`Applied color ${colors[index]} to cluster ${index}`);
                }
            });
        }
        
        // Render Mermaid
        mermaid.run().then(() => {
            console.log('Mermaid diagram rendered successfully');
            
            // Thay ƒë·ªïi m√†u n·ªÅn sau khi render - th·ª≠ nhi·ªÅu l·∫ßn
            setTimeout(() => {
                changeSubgraphColors();
                fitToScreen();
            }, 500);
            
            setTimeout(() => {
                changeSubgraphColors();
            }, 1000);
            
            setTimeout(() => {
                changeSubgraphColors();
            }, 2000);
        }).catch(err => {
            console.error('Mermaid rendering error:', err);
            document.getElementById('mermaidDiagram').innerHTML = '<p style="color: red; text-align: center; margin-top: 50px;">Error rendering diagram. Please refresh the page.</p>';
        });
        
        // NgƒÉn context menu khi right click
        document.getElementById('diagramContainer').addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        



        
        function showDiagram() {
            // Ch·ªâ hi·ªÉn th·ªã diagram container
            document.getElementById('diagramContainer').style.display = 'block';
        }




        // Zoom functions for diagram
        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 3);
            updateTransform();
        }

        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.1);
            updateTransform();
        }

        function resetZoom() {
            resetView();
        }

    </script>
</body>
</html>
